# HTPolyNet: High-Throughput Polymer Network Atomistic Simulations

Ming Huang and Cameron F Abrams

Drexel University

Department of Chemical and Biological Engineering

## Introduction

HTPolyNet is a utility for generating atomistic models of cross-linked polymer networks together with appropriate topology and parameter files required for molecular dynamics simulations using Gromacs.  It is intended as a fully automated system builder requiring as inputs only the molecular structures of any monomer species, a description of the polymerization chemistry, and a handful of options describing primarily the desired system size and composition.

HTPolyNet uses the Generalized Amber Force Field for atom-typing and parameter generation.

## Software Prerequisites
* [AmberTools19](https://ambermd.org/GetAmber.php#ambertools)
  - Options:
     * conda: `conda install -c ambermd ambertools` installs precompiled executables for ambertools into your Anaconda environment
     * compile from source:
       ```
       tar jxf AmberTools20.tar.bz2
       cd amber_src
       ./configure gnu
       source amber.sh
       make install
       ```
  - The specific executables needed are `antechamber`, `parmchk2`, and `tleap`
* [openbabel](http://openbabel.org/wiki/Category:Installation)
    - Options:
       * Install using package manager (Linux)
       * compile from source: (download tar file from the official website)
         ```
         tar zxf openbabel-2.3.2.tar.gz
         cd openbabel-2.3.2
         mkdir build
         cd build
         cmake ..
         make -j4
         make install
         ```
* [gromacs](https://manual.gromacs.org/documentation/2020/install-guide/index.html) v2016
  - Notes for 2016.6 on OpenSUSE Leap 15.2 with cuda 11 and openMPI:
    ```
    tar xfz gromacs-2016.6.tar.gz
    cd gromacs-2016.6
    mkdir build
    cd build
    cmake ..  -DGMX_BUILD_OWN_FFTW=ON -DREGRESSIONTEST_DOWNLOAD=ON -DGMX_MPI=on -DGMX_GPU=on -DCMAKE_INSTALL_PREFIX=/usr/local/gromacs-2016.6
    make
    make check
    sudo make install
    source /usr/local/gromacs-2016.6/bin/GMXRC  (added to ~/.bashrc)
    ```
  
* python3.x with the following modules (I'm using Anaconda)
  - numpy
  - pandas [ version > 1.0 ] 
  - scipy
  - parmed
    ```
    conda install -c omnia parmed
    ```
  - networkx
    ```
    conda install -c anaconda networkx
    ```
  
## Folder structure
* **basic**

  This folder contains two files. 
  - *options.txt* 
  
     Contains all basic configuration of the crosslinking procedures
  - *charges.txt*
    
    Charge database. Automatically generated by the code. 
   
* **mdp**
  
  - *em.mdp*        <p>options of all minimization simulation
  - *npt-init.mdp*  <p>options of init system NPT ensemble simulations
  - *npt-sw.mdp*    <p>options of stepwise NPT ensemble simulations 
  - *npt-cl.mdp*    <p>options of NPT ensemble simulations of crosslink procedure for 
                    each step
* **systems**

  This folder is an example template. It is not necessary when starts a new project. This
  Folder will be automatically generated.
  
  - *unrctSystem*   <p>Folder contains raw mol2 file. The folder also contains 
                        other files which generated by antechamber and parmed
  - *typeSystem*    <p>All files in this folder are used for getting charge 
                        for reacted molecules. All files in these folder are 
                        automatically generated. If you want to start a totally 
                        new project, please empty this folder
  - *rctSystem*     <p>All files in this folder are used for getting molecules 
                        information after crosslinked. All files in these folder are 
                        automatically generated. If you want to start a totally 
                        new project, please empty this folder

## Getting start
1. Clone this repository to the local
2. Set environment variable in ```~/.bashrc```
```
export PATH=$FOLDER$/HTPolyNet/mh-cl/src:$PATH
export HTPOLYPATH='$FOLDER$/HTPolyNet/mh-cl'
```
3. Make the 'src/HTPoly.py' script an execute script ```chmod +x HTPoly.net```
4. Prepare an empty folder
5. Prepare molecules (Currently only support mol2 file, each mol2 file contains one
    kind of molecule) and put them under this folder
    * Using any software to draw molecules and save as mol2 format
    * Using a unique name to label out the potential reacted atoms (second column)
        * The second column of the mol2 file should be "\[element name\]\[number\]".
           Hence using a unique number to label out the atom number
    * mol2 should be consisted only three parts.
        1. *Basic Infomation* 
        2. *@\<TRIPOS\> ATOM*  
        3. *@\<TRIPOS\> BOND* 
      There should be an empty line at the end of the *@\<TRIPOS\> BOND* part. 
      Otherwise **ANTECHAMBER** will complain on this
    * Name of the mol2 file should not include keywords "MON" nor "CRO"
6. Prepare the *options.txt* and put it under this folder. The *options.txt* template is 
    in the basic folder.
    
    - Basic Information
        ```
        reProject = proj1  # If want to restart a proj folder, add this option otherwise, can 
                           # ignore this option 
        boxSize = 5        # Initial size of the system. If the box is not big enough
        cutoff = 0.5       # Initial cutoff for radius cutoff searching
        bondsRatio = 0.95  # Desired conversion 
        HTProcess = True   # If do the Head-Tail check 
        CPU = 32           # number of CPU used for MD simulation
        trials = 5         # Replica want to generate (Not gurantee all trials will goes to desired conversion)
        ```
        - *boxSize*: If the box size is not big enough, not all molecules can be
                        inserted to the box which may cause the algorithms cannot
                        obtain expected number of molecules and force quit. 
                        But if the box size is so large which will delay the 
                        performance
                        
    - Molecules are separeted into two categories, crosslinker and monomer. Each 
        can have multiple molecules. 
        ```
        croName1 = VEA # Name should be consist with the mol2 name 
        ...
       
        croName2 = VEB
        ...
       
        monName1 = STYA
        ...
        
        monName2 = STYB
        
        ...
        ``` 
    - Molecules' properties
        ```
        croName1 = VEA
        croNum1 = 4    # number of the molecules
        cro1R_list = C19, C20, C26, C27  # Unique atom names which defined in the mol2 file
        cro1R_rNum = 1, 1, 1, 1          # How many times that each atoms can be reacted
        cro1R_rct = H, T, H, T           # Atoms' head and tail properties 
        cro1R_group = 1, 1, 2, 2         # atoms group on the molecules 
        ```
    
    - React Information
    
        Chemical mechanism of the system. In this part, list all potential reactions.
        Don't need to consider the sequence. 'VEA + VEB' is the same as 'VEB + VEA'.
        Add the reactivity probability at the end of each line
        ```
        VEA + VEA + 100.0%
        VEA + VEB + 100.0%
        ...
        ```
4. Run the algorithm
    ```HTPolyNet.py```
    
5. All results locate in the *results* folder. Different replica locate in the 
    different folder. Bonds formed information is in the file *bond.txt*. When
    one replica been finished, structure will be located in the *Final* folder 
